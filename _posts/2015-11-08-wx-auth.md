---
layout : post
title : "【一步一步走】微信服务号网页授权获取用户基本信息Java"
category : "微信"
tags : [微信,java]
published: false
---

## 需求

在做一个小的微信内网页应用时，需要收集微信用户的信息。

所以就查看了微信公众平台的开发者文档，并查找了一些资料，整理出下面的文档。

需要注意的是，订阅号没有`网页授权获取用户基本信息`这项功能。只有服务号才有，并且服务号需要通过微信认证。

## 配置

首先需要登陆微信的公众平台，在开发者中心找到`网页授权获取用户基本信息`这个接口，点击修改，修改`授权回调页面域名`。

这个地方只能是域名，并且不带`http://`。不支持IP地址，并且域名需要通过备案。

OK，如果配置好了，就可以进行下一步的开发了。

## 流程分析与逻辑

1，用户通过扫描二维码或者分享连接进入我们的应用首页

2，session中是否保存了用户数据，如果保存，进入应用；如果未保存，进入下一步

3，使用接口获取用户的openid，如果我们的数据库中保存的了用户的openid（即这个用户曾经进入过我们的应用），从数据库中查询出这个用户的信息，保存在session中。

4，如果为新的openid(即这个用户第一次进入我们的应用)，使用接口获取用户的信息（需要用户的授权）。如果用户授权，保存用户信息到数据库中，并保存信息到session中。

使用以上的方式，可以对于第二次登陆的用户实现静默跳转，即不用显示授权过XXX的页面，提高用户体验。

## 代码实现

使用java来做这个模拟的项目

csdn地址<https://code.csdn.net/xuhf_1988/wx>

参考连接<http://mp.weixin.qq.com/wiki/17/c0f37d5704f0b64713d5d2c37b468d75.html>
